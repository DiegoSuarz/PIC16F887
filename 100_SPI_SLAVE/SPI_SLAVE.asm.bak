;DESCRIPCION:
;EJEMPLO DE COMUNICACION SPI ENTRE 2 PICS: CODIGO DEL ESCLAVO
;MODO DE RELOJ 1,1 -> CKP =1, CKE=0		, SS(SELEC SLAVE) ACTIVO
;AL RECIBIR UN DATO POR SPI LO IMPRIME EN EL PUERTOD Y ENVIA
;LA LECTURA DEL PUERTOB
;---------------------------MACROS----------------------------
;---------------------------DEFINE----------------------------
;----------------------------EQU------------------------------
;---------------------------CBLOCK----------------------------
;---------------------------HEADER----------------------------
;					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\MACROS_INTERRUPT.ASM>	;MACRO PARA EL USO DE INTERRUPCIONES
;					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\MACROS_LCD.ASM>	;MACRO PARA EL USO DISPLAY LCD
;					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\MACROS_7SEG.ASM>	;MACRO PARA EL USO DISPLAY 7 SEG					
;					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\RETARDOS_MACROS.ASM> ;MACRO DE RETARDO
					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\MACROS_CONFIGURACION_INT.ASM> ;MACRO DE CONFIGURACION BASICA
					ORG			0X0000			;EMPEZAR EN LA DIRECCION 0 DE LA MEMORIA DE PROGRAMA
					GOTO		INICIALIZA
;					VECTOR_INTERRUPCION			;SI SE USA INTERRUPCIONES DESCOMENTAR
;					SIETE_SG_KC					;SI SE USA DISPLAY 7 SEG DESCOMENTAR
;************************************************************************                *************************************************************************
;TABLA_LCD			ADDWF			PCL,F
;LCD_FILA1			ADDWF			PCL,F
;					DT				""
;LCD_FILA2			ADDWF			PCL,F
;					DT				""	
					CONFIGURACION				;NOS DEJA EN EL BANCO 1						
;-----------------------CODIGO PRINCIPAL------------------------------
;ETIQUETAS			|NEMONICOS		| OPERANDOS 		| COMENTARIOS	
					CLRF			TRISD
					MOVLW			B'1101111'          ;BC5->SDO, BC4->SDI,BC3->SCK,
					MOVLW			TRISC
					
;*********************************CONFIGURACION SPI**************************
					CLRF			SSPSTAT
					BCF				SSPSTAT,SMP			;EN SPI MODO ESCLAVO SIEMPRE EN 0			
					BCF				SSPSTAT,CKE			;CKE=0,CKP = 1,TRANSMISION DE DATA EN EL FLANCO DE SUBIDA OF SCK
					BCF				SSPSTAT,BF			;BANDERA QUE INDICA QUE LA TRANSMISION ESTA COMPLETA (0), 1->TRANSMISION EN PROGRESO
					
					BSF				PORTA,5				;ENTRADA PARA SELECT SLAVE
					
					BCF				STATUS,RP0			;BANCO 0
					
					CLRF			SSPCON
					BSF				SSPCON,SSPEN		;HABILITAR PUERTO SERIAL SINCRONO MODO SPI		
					BSF				SSPCON,CKP			;CKP = 1, CKE=0 ,TRANSMISION DE DATA EN EL FLANCO DE SUBIDA OF SCK
		
					BCF				SSPCON,SSPM0		;PUERTO SERIAL SINCRONO COMO SPI ESCLAVO, SS ACTIVADO				
					BCF				SSPCON,SSPM1
					BSF				SSPCON,SSPM2
					BCF				SSPCON,SSPM3		

;*************************************************************************
					MOVLW			SSPSTAT				;DIRECCIONAMIENTO INDIRECTO
					MOVWF			FSR					;LA ETIQUETA FSR SELECCIONA AUTOMATICAMENTE EL BANCO DONDE SE ENCUENTRA EL REGISTRO SSPSTAT
					

LOOP:				MOVF			PORTB,W
					MOVWF			SSPBUF				;CARGAR EL BUFFER SPI CON EL VALOR DEL PUERTO B
					BTFSS			INDF,BF				;DIRECCIONAMIENTO INDIRECTO DEL BIT DE BANDERA BUFFER SPI
					GOTO 			$-1					;AUN NO SE PUSO A 1, VUELVE A PREGUNTAR POR LA BANDERA
					MOVF			SSPBUF,W			;LEER EL BUFFER DEL SPI Y MOVER EL CONTENIDO AL ACUMULADOR W
					MOVWF			PORTD				;MOVER EL CONTINIDO DEL BUFFER AL PUERTO D
					GOTO 			LOOP



;------------------SERVICIO DE RUTINA DE INTERRUPCION-----------------
;ISR:				
				
;FIN_INT:			RESTORE_REG							;RESTAURAMOS LOS REGISTROS DE INTERES
;					RETFIE								;REGRESAMOS DE LA INTERRUPCION
					
;-------------------------SUBRUTINAS----------------------------------
;---------------------------TABLAS------------------------------------
;---------------------------LIBRERIAS--------------------------------
					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\LIBRERIA_RETARDOS.asm>
;					INCLUDE		<D:\Archivos\Programacion\Microcontroladores\PIC\ASSEMBLER\MPASM\PIC16F887\LIBRERIAS\LIBRERIA_LCD.asm>		
					END
;*************************************************************************
;COMENTARIOS
;PARA USAR ANTIREBOTE COPIAR EN SUBRUTINA 	SUBT25MS:			RETARDO_3V		.3,.47,.25
;*************************************************************************
;PARA INICIALIZAR PANTALLA LCD: LLAMAR SUBRUTINA   INIT_LCD
;PARA ESCOJER UNA COLUMNA DE LA FILA1:  	FILA1_POSICION	.X		X: 0-15
;MOSTRAR MENSAJE LLAMA LA SUBRUTINA   		CALL		MENSAJE_FILA1
;PARA ESCOJER UNA COLUMNA DE LA FILA2:  	FILA1_POSICION	.X		X: 0-15
;MOSTRAR MENSAJE EN LA FILA 2 CON LA MACRO  	CALL		MENSAJE_FILA2